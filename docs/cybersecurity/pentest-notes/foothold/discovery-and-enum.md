---
sidebar_position: 1
---
# Host Discovery and Service Enumeration

## Network Scanning

### Host discovery

For nmap, sometimes hosts are configured to block ping scanning. Use `-Pn` flag for this.
```bash
# Quickly ping hosts in subnet with (nmap is slower):
time for i in $(seq 1 254); do (ping -c 1 10.120.15.${i} | grep "bytes from" &); done;

# Quick scan to see if hosts are up
nmap -sn 10.11.1.1-254

# Scan network for hosts with particular port open
nmap -Pn -p<port> <target networks>

# For large networks use masscan
sudo masscan -p80 10.11.1.0/24 --rate=1000 -e tap0 --router-ip 10.11.0.1 
```

When scanning for hosts, also try reverse lookup for names:

```bash
for ip in $(seq 50 100); do host 38.100.193.$ip <nameserver-ip>; done | grep -v "not found"
```

You can use DNS to gather information too. Try doing zone transfer:

```bash
# with dig
dig axfr @<nameserver-ip> <domain>

# with dnsrecon
dnsrecon -d megacorpone.com -t axfr

# with host
host -l <domain> <nameserver>
```

### Service Enumeration

For regular TCP scans:
```bash
# Scan all ports to filter out closed ones
nmap -sS -p- --min-rate 3000 <IP>

# Scan version, OS, and nse on open ports. For example if 80,443,139,445 were open:
nmap -sSCV -p<open ports> <IP>

# Scan for vulns on specific ports
nmap -Pn -p<port> --script vuln 10.10.10.4
```

Scan UDP:
```bash
nmap -sU -p- --min-rate 3000 -oA nmap/alludp 10.10.10.105
```

Notes:
* SYN scan(-sS) needs root privs! Add sudo if necessary. Connect scan(-sT) doesn't.
* When scanning with port forwarding or other tunnels, such as with `proxychains`, use `-sT` because SOCKS proxy can't use SYN scan and `-Pn` because ICMP is blocked!

### SNMP

> SNMP is based on UDP, a simple, stateless protocol, and is therefore susceptible to IP spoofing and replay attacks. In addition, the commonly used SNMP protocols 1, 2, and 2c offer no traffic encryption, meaning that SNMP information and credentials can be easily intercepted over a local network. Traditional SNMP protocols also have weak authentication schemes and are commonly left configured with default public and private community strings.

Scanning for hosts with:

```bash
# nmap scan for open snmp
sudo nmap -sU --open -p 161 10.11.1.1-254 

# or use onesixtyone (snmp enum tool)
# save community strings to a file
echo public > community 
echo private >> community 
echo manager >> community 

# save ips to a file
for ip in $(seq 1 254); do echo 10.11.1.$ip; done > ips 

# enum ips for community strings
onesixtyone -c community -i ips
```

Enumeration:

```bash
# must know community string, which is usually "public"
# enum MIB tree
snmpwalk -c public -v1 -t 10 10.11.1.14
# enum windows user
snmpwalk -c public -v1 10.11.1.14 1.3.6.1.4.1.77.1.2.25 

# enum running processes
snmpwalk -c public -v1 10.11.1.73 1.3.6.1.2.1.25.4.2.1.2 

# enum open ports
snmpwalk -c public -v1 10.11.1.14 1.3.6.1.2.1.6.13.1.3 

# enum installed software
snmpwalk -c public -v1 10.11.1.50 1.3.6.1.2.1.25.6.3.1.2
```